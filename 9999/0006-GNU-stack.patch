https://sourceware.org/bugzilla/show_bug.cgi?id=33780#c10
https://inbox.sourceware.org/binutils/9b6593a9-2c98-4a3d-87dd-c5bf29a5d573@suse.com/
https://inbox.sourceware.org/binutils/2c2094c6-65cb-442e-b474-184611d291fe@suse.com/
--- a/binutils/readelf.c
+++ b/binutils/readelf.c
@@ -23802,8 +23802,8 @@ process_notes_at (Filedata *           f
   char *end;
   bool res = true;
 
-  if (length <= 0)
-    return false;
+  if (length == 0)
+    return true;
 
   if (section)
     {

From 49c09f0770364570c37c2ad76e37754506e397d8 Mon Sep 17 00:00:00 2001
Message-ID: <49c09f0770364570c37c2ad76e37754506e397d8.1768782380.git.sam@gentoo.org>
From: "H.J. Lu" <hjl.tools@gmail.com>
Date: Thu, 15 Jan 2026 13:27:25 +0100
Subject: [PATCH] amend "ELF: give .note.GNU-stack proper section type"

PR ld/33780
Correct the section's special_sections[] entry as well, and further
constrain ld's setting of the section type.
---
 bfd/elf.c  | 2 +-
 ld/ldelf.c | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/bfd/elf.c b/bfd/elf.c
index 1177c3c3016..75a2e0b9358 100644
--- a/bfd/elf.c
+++ b/bfd/elf.c
@@ -3139,7 +3139,7 @@ static const struct bfd_elf_special_section special_sections_l[] =
 static const struct bfd_elf_special_section special_sections_n[] =
 {
   { STRING_COMMA_LEN (".noinit"),	 -2, SHT_NOBITS,   SHF_ALLOC + SHF_WRITE },
-  { STRING_COMMA_LEN (".note.GNU-stack"), 0, SHT_PROGBITS, 0 },
+  { STRING_COMMA_LEN (".note.GNU-stack"), 0, SHT_NOTE,     0 },
   { STRING_COMMA_LEN (".note"),		 -1, SHT_NOTE,	   0 },
   { NULL,		     0,		  0, 0,		   0 }
 };
diff --git a/ld/ldelf.c b/ld/ldelf.c
index fe4ab17b01f..a3f892a1934 100644
--- a/ld/ldelf.c
+++ b/ld/ldelf.c
@@ -1329,7 +1329,7 @@ ldelf_after_open (int use_libpath, int native, int is_linux, int is_freebsd,
 	  flagword flags = SEC_READONLY | (link_info.execstack ? SEC_CODE : 0);
 	  s = bfd_make_section_with_flags (link_info.input_bfds,
 					   ".note.GNU-stack", flags);
-	  if (s)
+	  if (s && bfd_get_flavour (s->owner) == bfd_target_elf_flavour)
 	    elf_section_type (s) = SHT_NOTE;
 	}
       return;

base-commit: c9c234a8a86cbbad03e92bc04f91b612e7f915e2
-- 
2.52.0

