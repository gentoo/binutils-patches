From 7daa5da3eab39e733f40eccbf4f6cd2078e3335e Mon Sep 17 00:00:00 2001
Message-ID: <7daa5da3eab39e733f40eccbf4f6cd2078e3335e.1735740264.git.sam@gentoo.org>
In-Reply-To: <4bed21d47f9d838dc6b55ce026989ede4eacc789.1735740264.git.sam@gentoo.org>
References: <4bed21d47f9d838dc6b55ce026989ede4eacc789.1735740264.git.sam@gentoo.org>
From: Sam James <sam@gentoo.org>
Date: Wed, 1 Jan 2025 14:03:44 +0000
Subject: [PATCH 07/10] Revert "macro.c:871 heap-buffer-overflow"

This reverts commit 6d9b7667974372357fed1f02c54a805f8c21dcde.
---
 gas/macro.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/gas/macro.c b/gas/macro.c
index 9670b38c152..5fa2011ab7a 100644
--- a/gas/macro.c
+++ b/gas/macro.c
@@ -868,7 +868,7 @@ sub_actual (size_t start, sb *in, sb *t, struct htab *formal_hash,
 	  /* The parent's FORMALs might contain parameters that need further
 	     substitution.  See gas/testsuite/gas/arm/macro-vld1.s for an
 	     example of this.  */
-	  if (memchr (add->ptr, '\\', add->len))
+	  if (strchr (add->ptr, '\\'))
 	    {
 	      sb newadd;
 
@@ -1485,7 +1485,7 @@ delete_macro (const char *name)
 	}
     }
 
-  if (j < 0)
+  if (macro == NULL)
     as_warn (_("Attempt to purge non-existing macro `%s'"), copy);
 
   free (copy);
-- 
2.47.1

